<%- include('includes/header') %>



    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
      <!-- wallet  -->
  <!-- ........................................add address...................................................... -->



  <button type="button" class="btn btn-dark me-auto ms-5 mb-5"  data-toggle="modal" data-target="#exampleModals" data-whatever="@mdo">Add new address</button>
           
            
  <div class="modal fade" id="exampleModals" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New message</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="place-order-form" action="/add-address" method="post">
              <div class="row">
                  <div class="col-lg-6">
                      <div class="checkout__input">
                          <p>Fist Name<span>*</span></p>
                          <input type="text" name="firstName">
                      </div>
                  </div>
                  <div class="col-lg-6">
                      <div class="checkout__input">
                          <p>Last Name<span>*</span></p>
                          <input type="text" name="lastName">
                      </div>
                  </div>
              </div>
              <div class="checkout__input">
                  <p>Country<span>*</span></p>
                  <input type="text" name="country">
              </div>
              <div class="checkout__input">
                  <p>Address<span>*</span></p>
                  <textarea type="text" placeholder="Street Address" name="address" class="checkout__input__add" style="    height: 160px;
                  width: 40%;"></textarea>
                  
              </div>
              <div class="checkout__input">
                  <p>Town/City<span>*</span></p>
                  <input type="text" name="town">
              </div>
              <div class="checkout__input">
                  <p>State<span>*</span></p>
                  <input type="text" name="state">
              </div>
              <div class="checkout__input">
                  <p>Postcode / ZIP<span>*</span></p>
                  <input type="text" name="pinCode">
              </div>
              <div class="row">
                  <div class="col-lg-6">
                      <div class="checkout__input">
                          <p>Phone<span>*</span></p>
                          <input type="text" name="mobile">
                      </div>
                  </div>
                  <div class="col-lg-6">
                      <div class="checkout__input">
                          <p>Email<span>*</span></p>
                          <input type="text" name="email">
                      </div>
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit"  class="btn btn-primary" onclick="address()">Add to address</button>
                </div>
          </form>
        </div>
        
      </div>
    </div>
  </div>

  <!-- ....................................add address........................................................... -->


  <!---------------------------------------edit address-------------------------------------------------------------->

  <div class="modal fade" id="editAddress" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New message</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="edit-order-form" action="/edit_address" method="post">
              <div class="row">
                  <div class="col-lg-6">
                      <div class="checkout__input">
                          <p>Fist Name<span>*</span></p>
                          <input type="text"  name="firstName" id="firstName">
                      </div>
                  </div>
                  <div class="col-lg-6">
                      <div class="checkout__input">
                          <p>Last Name<span>*</span></p>
                          <input type="text" name="lastName" id="lastName">
                      </div>
                  </div>
              </div>
              <div class="checkout__input">
                  <p>Country<span>*</span></p>
                  <input type="text" name="country" id="countryName">
              </div>
              <div class="checkout__input">
                  <p>Address<span>*</span></p>
                  <textarea type="text" placeholder="Street Address" name="address" class="checkout__input__add" id="addressName" style="    height: 160px;
                  width: 40%;"></textarea>
                  
              </div>
              <div class="checkout__input">
                  <p>Town/City<span>*</span></p>
                  <input type="text" id="townName" name="town">
              </div>
              <div class="checkout__input">
                  <p>State<span>*</span></p>
                  <input type="text" name="state" id="stateName">
              </div>
              <div class="checkout__input">
                  <p>Postcode / ZIP<span>*</span></p>
                  <input type="text" name="pinCode" id="pincodeName">
              </div>
              <div class="row">
                  <div class="col-lg-6">
                      <div class="checkout__input">
                          <p>Phone<span>*</span></p>
                          <input type="text" name="mobile" id="mobileName">
                      </div>
                  </div>
                  <div class="col-lg-6">
                      <div class="checkout__input">
                          <p>Email<span>*</span></p>
                          <input type="text" name="email" id="emailName">
                      </div>
                      <input type="hidden" name="addressID" id="addressID">
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit"  class="btn btn-primary"  >Update</button>
                </div>
          </form>
        </div>
        
      </div>
    </div>
  </div>
  
  <!---------------------------------------edit address-------------------------------------------------------------->


<div class="row ms-5">
  <% if( address == null){%>
    <%}else{%>
  <% address.userAddress.forEach(function(user){%>
   
  

    <div class="card ms-5 mb-5" style="width: 30rem;">
      <div class="card-body">
        <form action="" id="" class="<%=user._id%><%=user._id%>"></form>
        <input type="radio" class="radio" name="address" id="<%=user._id%>" onclick="changeDefualt('<%=user._id%><%=user._id%>','<%=user._id%>')" >
        <div class="col-md-12">Name <span class="ms-3" style="color: rgb(207, 4, 4);"><%=user.firstName%>&nbsp;&nbsp;<%=user.lastName%></span></div> <br>
                <div class="col-md-12">Country <span class="ms-3" style="color: rgb(207, 4, 4);"><%=user.country%></span></div> <br>
                <div class="col-md-12">House<span class="ms-3" style="color: rgb(207, 4, 4);"> <%=user.address%></span></div> <br>
                <div class="col-md-12">Town<span class="ms-3" style="color: rgb(207, 4, 4);"><%=user.town%></span></div> <br>
                <div class="col-md-12">State<span class="ms-3" style="color: rgb(207, 4, 4);"><%=user. state%></span></div> <br>
                <div class="col-md-12">Pin code<span class="ms-3" style="color: rgb(207, 4, 4);"><%=user. pinCode%></span></div> <br>
                <div class="col-md-12">Mob<span class="ms-3" style="color: rgb(207, 4, 4);"><%=user. mobile%></span></div> <br>
                <div class="col-md-12">Email<span class="ms-3" style="color: rgb(207, 4, 4);"><%=user. email%></span></div> <br>
      </div>
      <div class="Card-bottom">
        <%if(display == 1313){%>
          <button class="btn" onclick="delete_address('<%=user._id%>')">‚ùå DELETE ADDRESS</button>
        <%}else{%>
          <a onclick="continueAdress('<%=user._id%>')"  href="/place-order?id=<%=user._id%>"><button class="btn"  >CONTINUE</button></a>
          <%}%>
        <button class="btn" data-toggle="modal" data-target="#editAddress" onclick="edit_address('<%=user._id%>','<%=user.firstName%>','<%=user.lastName%>','<%=user.country%>','<%=user.town%>','<%=user.state%>','<%=user.pinCode%>','<%=user.mobile%>','<%=user.email%>')"> <i class="fa-solid fa-pen-to-square"></i> EDIT ADDRESS</button>
      
      </div>
    </div>

    <style>
      .error{
        color: red;
      }
    </style>
       
    <script>
          
      if("<%=user.addressStatus%>" === "true"){
        console.log("somemtreihtiu");
        
        $("#<%=user._id%>").prop("checked", true)
      }
  
      function changeDefualt(id,addressID){
        $.ajax({
          url : "/change-DefaultAddress",
          method : 'post',
          data : {
            addressID : addressID
          }
        })
      }
        function continueAdress(id){
        $.ajax({
          url : '/place-order?id='+id,
          method : 'get'
        })
      }
        function delete_address(addressID){
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax ({
                    url : '/delete-address?id='+addressID,
                    method : 'post',
                    success : (response) => {
                      if(response.status === true){
                        Swal.fire({
                        title: 'removed successfully ',
                       
                        icon: 'success',
                        showCancelButton: false,
                        confirmButtonColor: '#8dbd64',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'ok'
                        }).then((result) => {
                          window.location.reload()
                        })
                      }else{
                        Swal.fire({
                        title: 'cannot remove,this is a default one ',
                        text: "to remove change the default one",
                        icon: 'error',
                        showCancelButton: false,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'ok'
                        }).then((result) => {
                          window.location.reload()
                        })
                    
                      }
                    }
                    })
                    
                    
                }
                })              
        }
        function edit_address(addressID,firstName,lastName,country,town,state,pincode,mobile,email){
          console.log(email);
           let fName = document.getElementById('firstName')
           let lName = document.getElementById('lastName')
           let cName = document.getElementById('countryName')
           let aName = document.getElementById('addressName')
           let tName = document.getElementById('townName')
           let sName = document.getElementById('stateName')
           let pName = document.getElementById('pincodeName')
           let mName = document.getElementById('mobileName')
           let eName = document.getElementById('emailName')
           let useraddress = document.getElementById('addressID')
           fName.value = firstName
           lName.value = lastName
           cName.value = country
          
           tName.value = town
           sName.value = state
           pName.value = pincode
           mName.value = mobile
           eName.value = email
           useraddress.value = addressID
        }
    </script>

    <!------------------------------------------script-------------------------------------------->
     
     
    
<%})%>
<%}%>
</div>
  <!----------------------------------------  delete address script-------------------------------------------->
     
  

    <!-- Footer Section Begin -->
    <%- include('includes/footer') %>